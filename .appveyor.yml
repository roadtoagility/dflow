version: 0.1.0.{build}
skip_tags: true
image: Visual Studio 2019
configuration: Release

before_build:
 - nuget restore
 - choco install opencover.portable
 - choco install codecov

build_script:
  - dotnet restore DFlow.sln
  - dotnet build Dflow.sln /p:Configuration=Release /p:PackageVersion=%APPVEYOR_BUILD_VERSION%-pre /p:Version=%APPVEYOR_BUILD_VERSION% /p:ContinuousIntegrationBuild=true /verbosity:minimal
  - dotnet pack DFlow\DFlow.csproj -c Release --no-build /p:PackageVersion=%APPVEYOR_BUILD_VERSION%-pre /p:Version=%APPVEYOR_BUILD_VERSION%

test_script:
 - OpenCover.Console.exe -register:user -target:"%xunit20%\xunit.console.x86.exe" -targetargs:"DFlow.Tests\bin\Release\DFlow.Tests.dll -noshadow" -filter:"+[DFlow*]* -[Tests*]*" -output:".\DFlow_coverage.xml"
 
after_test:
 - codecov -f "DFlow_coverage.xml"

artifacts:
  - path: '**\*.nupkg'
  
deploy:
  provider: NuGet
  api_key:
    secure: nZHO3MlU3tR9ATVQIwsJKWwyALW3YVdmhgP+09+xhE9AVxDh9PwI+ZS/R1zq+tbr
  skip_symbols: false
  symbol_server:           # remove to push symbols to SymbolSource.org
  artifact: /.*(\.|\.s)nupkg/

